// DarkRoom node
// you can read out the registers via avalon bus in the following way:
// #define IORD(base,reg) (*(((volatile uint32_t*)base)+reg))
// #define IOWR(base,reg,data) (*(((volatile uint32_t*)base)+reg)=data)
// where reg corresponds to the address of the avalon slave

`timescale 1ns/10ps

module DarkRoom (
	input clock,
	input reset_n,
	// this is for the avalon interface
	input [3:0] address,
	input write,
	input signed [31:0] writedata,
	input read,
	output signed [31:0] readdata,
	output waitrequest,
	// these are the spi ports
	input [15:0] sensor_signal_i
);

// sensor results
reg unsigned [31:0] sensor0;
reg unsigned [31:0] sensor1;
reg unsigned [31:0] sensor2;
reg unsigned [31:0] sensor3;
reg unsigned [31:0] sensor4;
reg unsigned [31:0] sensor5;
reg unsigned [31:0] sensor6;
reg unsigned [31:0] sensor7;
reg unsigned [31:0] sensor8;
reg unsigned [31:0] sensor9;
reg unsigned [31:0] sensor10;
reg unsigned [31:0] sensor11;
reg unsigned [31:0] sensor12;
reg unsigned [31:0] sensor13;
reg unsigned [31:0] sensor14;
reg unsigned [31:0] sensor15;

assign readdata = 
	((address == 0))? sensor0 :
	((address == 1))? sensor1 :
	((address == 2))? sensor2 :
	((address == 3))? sensor3 :
	((address == 4))? sensor4 :
	((address == 5))? sensor5 :
	((address == 6))? sensor6 :
	((address == 7))? sensor7 :
	((address == 8))? sensor8 :
	((address == 10))? sensor9 :
	((address == 11))? sensor10 :
	((address == 12))? sensor11 :
	((address == 13))? sensor12 :
	((address == 14))? sensor13 :
	((address == 15))? sensor14 :
	((address == 16))? sensor15 :
	32'hDEAD_BEEF;

// when spi is done we transfer the results, which would be a bad time to read the values.
assign waitrequest = 0;
	
always @(posedge clock, negedge reset_n) begin: DARKROOM_LOGIC
	if (reset == 0) begin
		
	end else begin
	
		// if we are writing via avalon bus and waitrequest is deasserted, write the respective register
//		if(write && ~waitrequest) begin
//			case(address)
//				0: reset_myo_control <= 1; 
//			endcase 
//		end
	end 
end

wire clock_1MHz;

pll pll_1MHz(
	.refclk(clock),
	.rst(reset),
	.outclk_0(clock_1MHz)
);

lighthouse sensor0_decoder(
	.sensor(sensor_signal_i[0]),
	.timer(clock_1MHz),
	.sensor_value(sensor0)
);

endmodule

